---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/language/expressions.html
---

<div class="document">
      <h1>
        <a id="expressions" class="header-link anchor" href="#expressions">
          Expressions
        </a>
      </h1>
    <p>Expressions in Malloy are much like expressions in any other language; they can have variables and operators and function calls in
the same syntax users are familiar with. However, Malloy also introduces several other kinds of expressions useful for the task of data analysis and transformation.</p>
<table>
<thead>
<tr>
<th>Section</th>

<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td><a href="#identifiers">Identifiers</a><br/>Fields referenced by name</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">city</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">`year`</span></span></code></td>
</tr>

<tr>
<td><a href="#mathematical-operators">Mathematical operations</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> * </span><span style="color: #098658">100</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">-</span><span style="color: #001080">cost</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">(</span><span style="color: #001080">a</span><span style="color: #000000"> + </span><span style="color: #001080">b</span><span style="color: #000000">) / </span><span style="color: #001080">c</span></span></code></td>
</tr>

<tr>
<td><a href="#comparison-operators">Comparison operators</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> &gt; </span><span style="color: #098658">200</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span><span style="color: #000000"> != </span><span style="color: #0000FF">null</span></span></code></td>
</tr>

<tr>
<td><a href="#boolean-operators">Boolean operators</a><br/>Logically combine booleans</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">height</span><span style="color: #000000"> &gt; </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">height</span><span style="color: #000000"> &lt; </span><span style="color: #098658">100</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">is_cancelled</span><span style="color: #000000"> </span><span style="color: #0000FF">or</span><span style="color: #000000"> </span><span style="color: #001080">is_delayed</span></span></code></br><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">not</span><span style="color: #000000"> </span><span style="color: #001080">is_commercial_flight</span></span></code></td>
</tr>

<tr>
<td><a href="#sql-functions">SQL functions</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #098658">10.35</span><span style="color: #000000">)</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">concat</span><span style="color: #000000">(</span><span style="color: #001080">first_name</span><span style="color: #000000">, </span><span style="color: #A31515">&#39; &#39;</span><span style="color: #000000">, </span><span style="color: #001080">last_name</span><span style="color: #000000">)</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">sqrt</span><span style="color: #000000">(</span><span style="color: #001080">x</span><span style="color: #000000">)</span></span></code></td>
</tr>

<tr>
<td><a href="#aggregation">Aggregation</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000">)</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span></code></td>
</tr>

<tr>
<td><a href="ungrouped-aggregates.html">Aggregation Control / Subtotals</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000">))</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #795E26">count</span><span style="color: #000000">(), </span><span style="color: #001080">destination_code</span><span style="color: #000000">)</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">exclude</span><span style="color: #000000">(</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">(), </span><span style="color: #001080">carrier</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span><span style="color: #000000">)</span></span></code></td>
</tr>

<tr>
<td><a href="#filtered-expressions">Filtered expressions</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">avg</span><span style="color: #000000">(</span><span style="color: #001080">age</span><span style="color: #000000">) : [</span><span style="color: #001080">state</span><span style="color: #000000">: </span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000">]</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">flight_count</span><span style="color: #000000"> : [</span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">county</span><span style="color: #000000"> != </span><span style="color: #0000FF">null</span><span style="color: #000000">]</span></span></code></td>
</tr>

<tr>
<td><a href="#safe-type-cast">Safe type cast</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">total_distance</span><span style="color: #000000">::</span><span style="color: #267F99">string</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">some_date</span><span style="color: #000000">::</span><span style="color: #267F99">timestamp</span></span></code></td>
</tr>

<tr>
<td><a href="#pick-expressions">Pick expressions</a><br/>Malloy's take on <code>CASE</code> statements</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;S&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">size</span><span style="color: #000000"> &lt; </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;L&#39;</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">kind</span><span style="color: #000000">: </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;other&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span></span></code></td>
</tr>

<tr>
<td><a href="#time-ranges">Time ranges</a><br/>Ranges with start and end or duration</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">start_time</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">hours</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003 fo</span><span style="color: #000000">r </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">months</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003 to</span><span style="color: #000000"> </span><span style="color: #098658">@2005</span></span></code></td>
</tr>

<tr>
<td><a href="#numeric-ranges">Numeric ranges</a><br/>Numeric ranges with start and end</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #098658">20</span></span></code></td>
</tr>

<tr>
<td><a href="#time-truncation">Time truncation</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">event_time</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code></td>
</tr>

<tr>
<td><a href="#time-extraction">Time extraction</a><br/>Extract one part of a time value</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">day_of_year</span><span style="color: #000000">(</span><span style="color: #001080">event_time</span><span style="color: #000000">)</span></span></code> <br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minute</span><span style="color: #000000">(</span><span style="color: #001080">now</span><span style="color: #000000">)</span></span></code></td>
</tr>

<tr>
<td><a href="#interval-extraction">Interval extraction</a><br/>Extract the interval between two times</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">days</span><span style="color: #000000">(</span><span style="color: #001080">created_at</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">shipped_at</span><span style="color: #000000">)</span></span></code></td>
</tr>

<tr>
<td><a href="time-ranges.html#literals">Time literals</a></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003-04-19</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2020-Q4</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2021-10-24 10:00:00</span></span></code></td>
</tr>

<tr>
<td><a href="#partial-comparison">Partial comparison</a><br/>Reusable conditions</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt; </span><span style="color: #098658">42</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">!= </span><span style="color: #0000FF">null</span></span></code><br/><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">~ </span><span style="color: #811F3F">r&#39;C.*&#39;</span></span></code></td>
</tr>

<tr>
<td><a href="#alternation">Alternation</a><br/>Logically combine conditions</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt; </span><span style="color: #098658">5</span><span style="color: #000000"> &amp; &lt; </span><span style="color: #098658">10</span></span></code></br> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">&#39;red&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;blue&#39;</span></span></code></td>
</tr>

<tr>
<td><a href="#application">Application</a><br/>Apply conditions to values</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span><span style="color: #000000">: </span><span style="color: #A31515">&#39;CA&#39;</span></span></code><br/> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">weight</span><span style="color: #000000">: &gt; </span><span style="color: #098658">100</span><span style="color: #000000"> &amp; &lt; </span><span style="color: #098658">1000</span></span></code></td>
</tr>
</tbody></table>

      <h2>
        <a id="identifiers" class="header-link anchor" href="#identifiers">
          Identifiers
        </a>
      </h2>
    <!-- * `distance` --><!-- * `origin.city` --><!-- * `` `year` `` --><p>Fields may be referenced by name, and fields in joins or nested structures can be described using <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">.</span></span></code>s.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">county</span><span style="color: #000000"> != </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">} -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">project</span><span style="color: #000000">: </span><span style="color: #001080">by_county</span><span style="color: #000000">.</span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: left;">county</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top;"><span>ANCHORAGE</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>FAIRBANKS</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>JUNEAU</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANCHORAGE&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FAIRBANKS&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JUNEAU&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      origin_0.state</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> state__0,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      origin_0.county</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> county__1,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> flight_count__1</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.flights`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> flights</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> origin_0</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">ON</span><span style="color: #000000"> origin_0.code=flights.origin</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">OVER</span><span style="color: #000000">() -</span><span style="color: #098658">1</span><span style="color: #000000">  group_set </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> UNNEST(GENERATE_ARRAY(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> origin_0.county </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">, __stage1 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    state__0 </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">state</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    ARRAY_AGG(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> STRUCT(</span></span>
<span class="line"><span style="color: #000000">      county__1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> county, </span></span>
<span class="line"><span style="color: #000000">      flight_count__1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> flight_count</span></span>
<span class="line"><span style="color: #000000">      ) </span><span style="color: #0000FF">END</span><span style="color: #000000"> IGNORE NULLS  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  flight_count__1 </span><span style="color: #0000FF">desc</span><span style="color: #000000"> ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> by_county</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">asc</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   by_county_0.county </span><span style="color: #0000FF">as</span><span style="color: #000000"> county</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> UNNEST(base.by_county) </span><span style="color: #0000FF">as</span><span style="color: #000000"> by_county_0</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">3</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div><p>Identifiers that share a name with a keyword in Malloy must be enclosed in back ticks <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">`</span></span></code>, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">`year`</span></span></code>.</p>

      <h2>
        <a id="mathematical-operators" class="header-link anchor" href="#mathematical-operators">
          Mathematical Operators
        </a>
      </h2>
    <!-- * `x * 100` --><!-- * `-cost` --><!-- * `(a + b) / c` --><p>Typical mathematical operators <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">+</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">-</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">*</span></span></code>, and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">/</span></span></code> work as expected, and parentheses may be used to override precedence, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">six</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #098658">10</span><span style="color: #000000"> * (</span><span style="color: #098658">3</span><span style="color: #000000"> - </span><span style="color: #098658">2</span><span style="color: #000000">) / </span><span style="color: #098658">2</span><span style="color: #000000"> + </span><span style="color: #098658">1</span></span></code>.</p>
<p>The unary minus / negation operator is also allowed, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">value</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> -</span><span style="color: #001080">cost</span></span></code>.</p>

      <h2>
        <a id="logical-operators" class="header-link anchor" href="#logical-operators">
          Logical Operators
        </a>
      </h2>
    
      <h3>
        <a id="comparison-operators" class="header-link anchor" href="#comparison-operators">
          Comparison Operators
        </a>
      </h3>
    <!-- * `distance > 1000` --><!-- * `state = 'CA'` --><!-- * `name != null` --><!-- TODO discuss null checking and how it uses `!=` not `is not` --><p>Standard comparison operators <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt;</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&lt;</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt;=</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&lt;=</span></span></code>, and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">=</span></span></code> are available in Malloy. "Not equals" is expressed using the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">!=</span></span></code> operator.</p>

      <h3>
        <a id="boolean-operators" class="header-link anchor" href="#boolean-operators">
          Boolean Operators
        </a>
      </h3>
    <!-- * `is_x and is_y` --><!-- * `is_a or is_b` --><!-- * `not is_c` --><p>Malloy includes the basic binary boolean operators <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">and</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">or</span></span></code>, as well as the unary <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">not</span></span></code> operator.</p>

      <h2>
        <a id="sql-functions" class="header-link anchor" href="#sql-functions">
          SQL Functions
        </a>
      </h2>
    <!-- * `floor(10.35)` --><!-- * `concat(first_name, ' ', last_name)` --><!-- * `sqrt(x)` --><p>Many functions available in SQL are available unchanged in Malloy. See <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/syntax">here</a> for documentation on functions available in BigQuery.</p>
<p>The intention is to be able to call from Malloy any function which
you could call from Standard SQL. This is not well implemented at
the moment. If you experience type check errors, use the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">::</span><span style="color: #001080">type</span></span></code>
typecast to work around the errors in typing.</p>

      <h2>
        <a id="aggregation" class="header-link anchor" href="#aggregation">
          Aggregation
        </a>
      </h2>
    <p>Aggregations may included in an expression to create <a href="fields.html#measures">measures</a>, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">count</span><span style="color: #000000">()</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000">)</span></span></code>, or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span></code>. For detailed information, see the <a href="aggregates.html">Aggregates</a> section.</p>
<!-- TODO more info on symmetric aggregates -->
      <h2>
        <a id="filtered-expressions" class="header-link anchor" href="#filtered-expressions">
          Filtered Expressions
        </a>
      </h2>
    <!-- * `avg(age) : [state: 'CA']` --><!-- * `flight_count : [origin.county != null]` --><p>Aggregate expressions may be filtered, using the <a href="filters.html">usual filter syntax</a>.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">distance_2003</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000">) { </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">dep_time</span><span style="color: #000000"> ? </span><span style="color: #098658">@2003</span><span style="color: #000000"> }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">ca_flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">() { </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">state</span><span style="color: #000000"> ? </span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: right;">distance_​2003</th><th style="padding: 8px; text-align: right;">ca_​flights</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top; text-align: right;"><span>4,615,025,467</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>4,501,447</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance_2003&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4615025467</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;ca_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4501447</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> (flights.dep_time&gt;=</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;2003-01-01&#39;</span><span style="color: #000000">, </span><span style="color: #A31515">&#39;UTC&#39;</span><span style="color: #000000">))</span><span style="color: #0000FF">and</span><span style="color: #000000">(flights.dep_time&lt;</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;2004-01-01&#39;</span><span style="color: #000000">, </span><span style="color: #A31515">&#39;UTC&#39;</span><span style="color: #000000">)) </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> flights.distance </span><span style="color: #0000FF">END</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> distance_2003,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> origin_0.state=</span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> ca_flights</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.flights`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> flights</span></span>
<span class="line"><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> origin_0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">ON</span><span style="color: #000000"> origin_0.code=flights.origin</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="safe-type-cast" class="header-link anchor" href="#safe-type-cast">
          Safe Type Cast
        </a>
      </h2>
    <!-- * `total_distance::string` --><!-- * `some_date::timestamp` --><p>Safe type casting may be accomplished with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">::</span><span style="color: #001080">type</span></span></code> syntax.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">distance_summary</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">concat</span><span style="color: #000000">(</span><span style="color: #001080">total_distance</span><span style="color: #000000">::</span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #A31515">&#39; miles&#39;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: left;">distance_​summary</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top;"><span>27540298839 miles</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance_summary&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;27540298839 miles&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">concat</span><span style="color: #000000">(SAFE_CAST((</span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(flights.distance),</span><span style="color: #098658">0</span><span style="color: #000000">))  </span><span style="color: #0000FF">AS</span><span style="color: #000000"> string),</span><span style="color: #A31515">&#39; miles&#39;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> distance_summary</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.flights`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> flights</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="pick-expressions" class="header-link anchor" href="#pick-expressions">
          Pick Expressions
        </a>
      </h2>
    <p>The <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span></span></code> construction in Malloy is similar to <code>CASE</code> statements in SQL.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;small&#39;</span><span style="color: #000000">  </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">size</span><span style="color: #000000"> &lt; </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;medium&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">size</span><span style="color: #000000"> &lt; </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;large&#39;</span></span></pre><p>Pick expressions are also compatible with the <a href="#apply-operator">apply operator</a> and partial comparisons.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">size</span><span style="color: #000000"> ?</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;small&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &lt; </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;medium&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &lt; </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;large&#39;</span></span></pre><p>Pick can be used to "clean" data, combining similar dirty values into one clean value. In the following example, the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span></span></code> statement collects all the "this actually
shipped" statuses, and because there is no <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">else</span></span></code>, leaves the other
status values alone.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">shipping_status</span><span style="color: #000000"> ?</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;shipped&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;will call&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;shipped&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;ignore&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;bad1&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;bad2&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;testing&#39;</span></span></pre><p>Another common kind of cleaning is to have a small set you want to group
by and all other values are compressed into <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">null</span></span></code>. A <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span></span></code> clause with no value
picks an applied value when the condition is met.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">status</span><span style="color: #000000"> ?</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;good&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;ok&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;fine&#39;</span><span style="color: #000000"> </span><span style="color: #008000">// leave these alone</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">                        </span><span style="color: #008000">// ignore the rest</span></span></pre><p>If you need to match on multiple fields and conditions, use a dimension.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">Facility_Type_State</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;Cali Heli&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">state</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;Seaplane at SeaTac&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">state</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;WA&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">city</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;SEATTLE&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;SEAPLANE BASE&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;Phoenix Ultra&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> </span><span style="color: #001080">state</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;AZ&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;ULTRALIGHT&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">city</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;PHOENIX&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;Not Needed&#39;</span></span></pre>
      <h2>
        <a id="time-expressions" class="header-link anchor" href="#time-expressions">
          Time Expressions
        </a>
      </h2>
    <p>Malloy has built in constructs to simplify many time-related operations, which are described here.</p>

      <h3>
        <a id="time-ranges" class="header-link anchor" href="#time-ranges">
          Time Ranges
        </a>
      </h3>
    <p><a id="numeric-ranges"></a></p>
<p>Ranges between a start and end time can be constructed with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">to</span></span></code> operator, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003 to</span><span style="color: #000000"> </span><span style="color: #098658">@2006</span></span></code>. This kind of range is also possible for numbers, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #098658">20</span></span></code>.</p>
<p>Time ranges can also be constructed with a start time and duration using the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">for</span></span></code> operator, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003 fo</span><span style="color: #000000">r </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">years</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">20</span><span style="color: #000000"> </span><span style="color: #0000FF">minutes</span></span></code>.</p>
<p>A time value can be compared to a range. If the time is within the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">=</span></span></code>, before the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&lt;</span></span></code>, and after the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt;</span></span></code>. If you <a href="#apply-operator">apply</a> a time to a range, (for example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">event_time</span><span style="color: #000000"> ? </span><span style="color: #098658">@2003 to</span><span style="color: #000000"> </span><span style="color: #098658">@2004</span></span></code>) that will also check if the value is within the range.</p>

      <h3>
        <a id="time-truncation" class="header-link anchor" href="#time-truncation">
          Time Truncation
        </a>
      </h3>
    <p>To truncate a time value to a given timeframe, use the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">.</span></span></code> operator followed by the timeframe, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">event_time</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code>.</p>
<p>By way of example, if the value of <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span></span></code> is <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2021-08-06 00:36</span></span></code>, then the below truncations will produce the results on the right:</p>
<table>
<thead>
<tr>
<th>truncation</th>

<th>result</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">minute</span></span></code></td>

<td>2021-08-06 00:36</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">hour</span></span></code></td>

<td>2021-08-06 00:00</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">day</span></span></code></td>

<td>2021-08-06</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">week</span></span></code></td>

<td>WK2021-08-01 <em>(the week containing the 10th)</em></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span></code></td>

<td>2021-08</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span></code></td>

<td>Q2-2021</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code></td>

<td>2021</td>
</tr>
</tbody></table>
<p>A truncation made this way (unlike a truncation make in SQL with
<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">TIMESTAMP_TRUNC</span><span style="color: #000000">()</span></span></code>) can also function as a range. The range begins
at the moment of truncation and the duration is the timeframe unit
used to specify the truncation, so for example <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code>
would be a range covering the entire year which contains <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span></span></code>.</p>
<p>This is extremely useful with the <a href="#apply-operator">apply operator</a>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">?</span></span></code>. To see if two events happen in the same calendar year, for example, the boolean expression in Malloy is <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">one_time</span><span style="color: #000000"> ? </span><span style="color: #001080">other_time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code>.</p>

      <h3>
        <a id="time-extraction" class="header-link anchor" href="#time-extraction">
          Time Extraction
        </a>
      </h3>
    <p>Another very common grouping for time related data is by particular components, and this extraction of a single component as an integer. In Malloy this gesture looks like a function call.</p>
<p>The "Result" column uses a value of <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2021-08-06 00:55:05</span></span></code> for <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span></span></code>.</p>
<table>
<thead>
<tr>
<th>expression</th>

<th>meaning</th>

<th>result</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">day_of_year</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of year, 1-365</td>

<td>218</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">day</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of month 1-31</td>

<td>5</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">day_of_week</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of week 1-7</td>

<td>6 <em>(Note: 1 represents Sunday)</em></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">week</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>week in year, 1-53</td>

<td>31</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">quarter</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>quarter in year 1-4</td>

<td>3</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">hour</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>hour of day 0-23</td>

<td>0</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minute</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>minute of hour 0-59</td>

<td>55</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">second</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>second of minute 0-59</td>

<td>5</td>
</tr>
</tbody></table>

      <h3>
        <a id="interval-extraction" class="header-link anchor" href="#interval-extraction">
          Interval extraction
        </a>
      </h3>
    <p>To measure the difference between two times, pass a range expression to
one of the below extraction functions. This is Malloy's take on SQL's <code>DATE_DIFF()</code> and <code>TIMESTAMP_DIFF()</code> :</p>
<table>
<thead>
<tr>
<th>expression</th>

<th>meaning</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">seconds</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>Number of seconds from <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">t1</span></span></code> until <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">t2</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minutes</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... minutes ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">hours</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... hours ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">days</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... days ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">weeks</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... weeks ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">months</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... months ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">quarters</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... quarters ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">years</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... years ...</td>
</tr>
</tbody></table>
<p>These will return a negative number if <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">t1</span></span></code> is later than <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">t2</span></span></code>.</p>
<p>For <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">seconds</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">minutes</span></span></code>, and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">hours</span></span></code>, the returned values is the number of complete seconds/minutes/hours beween the two values. For example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">hours</span><span style="color: #000000">(</span><span style="color: #098658">@2022-10-03 10:30:00</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #098658">@2022-10-03 11:29:00</span><span style="color: #000000">)</span></span></code> would return 0, because the range spans only 59 minutes, despite crossing over the hour boundry from 10 to 11. Likewise, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minutes</span><span style="color: #000000">(</span><span style="color: #001080">now</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">now</span><span style="color: #000000"> + </span><span style="color: #098658">59</span><span style="color: #000000"> </span><span style="color: #0000FF">seconds</span><span style="color: #000000">)</span></span></code> will always return 0, regardless of what time it is.</p>
<p>For <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">days</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">weeks</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">months</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">quarters</span></span></code>, and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">years</span></span></code>, the returned value is the number of day/week/month/quarter/year boundaries crossed between the two dates. For example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">days</span><span style="color: #000000">(</span><span style="color: #098658">@2022-10-03 11:59</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #098658">@2022-10-04 00:00</span><span style="color: #000000">)</span></span></code> is 1, because the end time is on the day after the start time, even though only one minute passed between them. So <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">weeks</span><span style="color: #000000">(</span><span style="color: #001080">now</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">now</span><span style="color: #000000"> + </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">days</span><span style="color: #000000">)</span></span></code> will return either 0 or 1 depending on the day of the week.</p>

      <h3>
        <a id="time-literals" class="header-link anchor" href="#time-literals">
          Time Literals
        </a>
      </h3>
    <!-- * `@2003-04-19` --><!-- * `@2020-Q4` --><!-- * `@2021-10-24 10:00:00` --><!-- * `now` --><p>Time literals are specified in Malloy with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@</span></span></code> character. A literal
specified this way has an implied duration which means a literal
can act like a range.</p>
<p>For example the year <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003</span></span></code> can be used with <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">event_time</span><span style="color: #000000">: </span><span style="color: #098658">@2003</span></span></code> to test if the
event happened in the year 2003.</p>
<table>
<thead>
<tr>
<th>Literal pattern</th>

<th>Duration</th>

<th>Begins</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD</span></span></code></td>

<td>One year</td>

<td>The first day of that year</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-QN</span></span></code></td>

<td>Three months</td>

<td>The first day of that quarter</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM</span></span></code></td>

<td>One month</td>

<td>The first day of that month</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@WKDDDD-MM-SS</span></span></code></td>

<td>Seven days</td>

<td>Sunday of the week containing that day</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD</span></span></code></td>

<td>One day</td>

<td>Midnight on the specified date</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD HH:MM</span></span></code></td>

<td>One Minute</td>

<td>The specified time</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD HH:MM:SS</span></span></code></td>

<td>One Second</td>

<td>the specified time</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span></span></code></td>

<td><em>n/a</em></td>

<td>The current time, without implied duration</td>
</tr>
</tbody></table>

      <h2>
        <a id="special-filter-expression-syntax" class="header-link anchor" href="#special-filter-expression-syntax">
          Special Filter Expression Syntax
        </a>
      </h2>
    <p>As filtering is an incredibly common operation in data analysis, Malloy has special syntax to make filter expressions succinct and powerful. In addition to regular comparison and boolean operators, Malloy includes <em>partial comparisons</em>, <em>alternation</em>, and <em>application</em>, as described below.</p>

      <h3>
        <a id="partial-comparison" class="header-link anchor" href="#partial-comparison">
          Partial Comparison
        </a>
      </h3>
    <!-- * `> 42` --><!-- * `!= null` --><!-- * `~ r'C.*'` --><p>Partial comparisons, or "partials" are written with a binary comparison operator followed by a value, e.g. <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt; </span><span style="color: #098658">42</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">!= </span><span style="color: #0000FF">null</span></span></code>. These can be thought of as conditions-as-values, or as functions that return a boolean.</p>

      <h3>
        <a id="alternation" class="header-link anchor" href="#alternation">
          Alternation
        </a>
      </h3>
    <!-- * `> 5 & < 10` --><!-- * `'CA' | 'NY'` --><p>Conditions can be logically combined with the two alternation operators, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&amp;</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">|</span></span></code>. These are different from <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">and</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">or</span></span></code> in that they operate on conditions which return boolean values, rather than boolean values directly.</p>
<p>The <em>union alternation</em> operator <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">|</span></span></code> represents the logical union of two conditions. An expression like <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> | </span><span style="color: #001080">y</span></span></code> can be read "if either <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">y</span></span></code>." For example <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">= </span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> | = </span><span style="color: #A31515">&#39;NY&#39;</span></span></code> represents the condition "is either CA or NY".</p>
<p>The <em>conjunction alternation</em> operator <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&amp;</span></span></code> represents the logical conjunction of two conditions. An expression like "<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> &amp; </span><span style="color: #001080">y</span></span></code> can be read "if both <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">y</span></span></code>." For example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt; </span><span style="color: #098658">5</span><span style="color: #000000"> &amp; &lt; </span><span style="color: #098658">10</span></span></code> represents the condition "is greater than 5 and less than 10".</p>
<p>Values can be used directly with the alternation operators, in which case the operator is assumed to be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">=</span></span></code>. For example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> | </span><span style="color: #A31515">&#39;NY&#39;</span></span></code> is equivalent to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">= </span><span style="color: #A31515">&#39;CA&#39;</span><span style="color: #000000"> | = </span><span style="color: #A31515">&#39;NY&#39;</span></span></code>.</p>

      <h3>
        <a id="application" class="header-link anchor" href="#application">
          Application
        </a>
      </h3>
    <!-- * `state ? 'CA'` --><!-- * `weight ? > 100 & < 1000` --><!-- * `kind ? pick 'other' when null` --><p>The apply operator <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">?</span></span></code> "applies" a value to another value, condition, or computation. This is most often used with partial comparisons or alternations.</p>
<p>Applying a value to a condition is like filling in the condition with the given value. For example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">height</span><span style="color: #000000"> ? &gt; </span><span style="color: #098658">5</span><span style="color: #000000"> &amp; &lt; </span><span style="color: #098658">10</span></span></code> is equivalent to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">height</span><span style="color: #000000"> &gt; </span><span style="color: #098658">5</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">height</span><span style="color: #000000"> &lt; </span><span style="color: #098658">10</span></span></code>.</p>
<p>Applying a value to another value applies a default comparison on the two values:</p>
<table>
<thead>
<tr>
<th>Left</th>

<th>Right</th>

<th>Example</th>

<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">number</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">number</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">size</span><span style="color: #000000"> ? </span><span style="color: #098658">10</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">size</span><span style="color: #000000"> = </span><span style="color: #098658">10</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">string</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">string</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span><span style="color: #000000"> ? </span><span style="color: #A31515">&#39;CA&#39;</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;CA&#39;</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">string</span></span></code></td>

<td>regular expression</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">name</span><span style="color: #000000"> ? </span><span style="color: #811F3F">r&#39;Z$&#39;</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">name</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;Z$&#39;</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">boolean</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">boolean</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">is_cool</span><span style="color: #000000"> ? </span><span style="color: #0000FF">true</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">is_cool</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">number</span></span></code></td>

<td>numeric range</td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> ? </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #098658">20</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">x</span><span style="color: #000000"> &gt;= </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #001080">x</span><span style="color: #000000"> &lt; </span><span style="color: #098658">20</span></span></code></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">date</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">timestamp</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">date</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">timestamp</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span><span style="color: #000000"> ? </span><span style="color: #098658">@2003</span></span></code></td>

<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">time</span></span></code> is during 2003</td>
</tr>
</tbody></table>
<p>Values can be applied to <a href="#pick-expressions">pick expressions</a> to make them more succinct.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">size</span><span style="color: #000000"> ?</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;small&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &lt; </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;medium&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &lt; </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;large&#39;</span></span></pre></div>